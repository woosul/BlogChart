let currentCharts = {};
        let currentPattern = 'support';
        let currentAdvancedPattern = 'headShoulders';
        let practiceData = null;

        // ê³ ê¸‰ íŒ¨í„´ ì „í™˜
        function showAdvancedPattern(patternName) {
            currentAdvancedPattern = patternName;
            
            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.pattern-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            drawAdvancedChart();
            
            // ì„¤ëª… ì—…ë°ì´íŠ¸
            const explanation = advancedPatternData[patternName].explanation;
            document.getElementById('advancedExplanation').innerHTML = `
                <h3>${explanation.title}</h3>
                <ul>
                    ${explanation.points.map(point => `<li>${point}</li>`).join('')}
                </ul>
            `;
        }<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ì‹ ì°¨íŠ¸ íŒ¨í„´ìœ¼ë¡œ ë§¤ìˆ˜/ë§¤ë„ ì‹ í˜¸ ì°¾ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f8fafc;
            padding: 15px;
        }
        
        .chart-wrapper {
            max-width: 100%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        .tab-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .tab-button {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background: #f1f5f9;
            color: #64748b;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 12px;
            font-family: inherit;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(59, 130, 246, 0.4);
        }
        
        .tab-button:hover:not(.active) {
            background: #e2e8f0;
        }
        
        .chart-area {
            background: #f8fafc;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 2px solid #e2e8f0;
        }
        
        .chart-title {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .chart-canvas-area {
            height: 40vh;
            min-height: 250px;
            max-height: 400px;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 15px;
        }
        
        .volume-area {
            height: 20vh;
            min-height: 120px;
            max-height: 200px;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .pattern-selector {
            display: flex;
            gap: 6px;
            margin-bottom: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .pattern-btn {
            padding: 6px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 11px;
        }
        
        .pattern-btn.active {
            border-color: #3b82f6;
            background: #eff6ff;
            color: #1d4ed8;
        }
        
        .signal-indicator {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .signal-item {
            padding: 6px 12px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 11px;
        }
        
        .signal-buy {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            color: #166534;
            border: 2px solid #22c55e;
        }
        
        .signal-sell {
            background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
            color: #991b1b;
            border: 2px solid #ef4444;
        }
        
        .explanation {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #0ea5e9;
            margin: 15px 0;
        }
        
        .explanation h3 {
            color: #0c4a6e;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .explanation p {
            color: #0e7490;
            line-height: 1.5;
            margin-bottom: 8px;
            font-size: 13px;
        }
        
        .explanation ul {
            list-style: none;
            margin-top: 10px;
        }
        
        .explanation li {
            margin: 6px 0;
            padding-left: 15px;
            position: relative;
            color: #0e7490;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .explanation li:before {
            content: "â€¢";
            position: absolute;
            left: 0;
            color: #0ea5e9;
            font-weight: bold;
        }
        
        .story-box {
            background: linear-gradient(135deg, #fef7cd 0%, #fef3c7 100%);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #f59e0b;
        }
        
        .story-box h4 {
            color: #92400e;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .story-box p {
            color: #a16207;
            line-height: 1.4;
            font-size: 13px;
        }
        
        .success-box {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-left-color: #22c55e;
        }
        
        .success-box h4 {
            color: #166534;
        }
        
        .success-box p {
            color: #15803d;
        }
        
        .failure-box {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-left-color: #ef4444;
        }
        
        .failure-box h4 {
            color: #991b1b;
        }
        
        .failure-box p {
            color: #dc2626;
        }
        
        .btn {
            display: inline-block;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            text-decoration: none;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            font-size: 12px;
            margin: 3px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(59, 130, 246, 0.4);
        }
        
        .btn-secondary {
            background: #f1f5f9;
            color: #64748b;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
            color: #1e293b;
        }
        
        @media (max-width: 480px) {
            .tab-button {
                font-size: 11px;
                padding: 6px 12px;
            }
            
            .pattern-btn {
                font-size: 10px;
                padding: 5px 10px;
            }
            
            .chart-canvas-area {
                height: 250px;
                padding: 10px;
            }
            
            .volume-area {
                height: 120px;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="chart-wrapper">
        <!-- íƒ­ ë²„íŠ¼ -->
        <div class="tab-buttons">
            <button class="tab-button active" onclick="showTab('story')">
                ì‹¤íŒ¨ ìŠ¤í† ë¦¬
            </button>
            <button class="tab-button" onclick="showTab('basic')">
                ê¸°ë³¸ íŒ¨í„´
            </button>
            <button class="tab-button" onclick="showTab('advanced')">
                ê³ ê¸‰ íŒ¨í„´
            </button>
            <button class="tab-button" onclick="showTab('practice')">
                ì‹¤ì „ ì—°ìŠµ
            </button>
        </div>

        <!-- ìŠ¤í† ë¦¬ íƒ­ -->
        <div id="tab-story" class="tab-content">
            <div class="chart-area">
                <div class="chart-title">ì‹¤íŒ¨í•œ íˆ¬ì vs ì„±ê³µí•œ íˆ¬ì</div>
                <div class="chart-canvas-area">
                    <canvas id="storyChart"></canvas>
                </div>
                
                <div class="signal-indicator">
                    <div class="signal-item signal-sell">ì‹¤íŒ¨ í¬ì¸íŠ¸</div>
                    <div class="signal-item signal-buy">ì„±ê³µ í¬ì¸íŠ¸</div>
                </div>
            </div>
            
            <div class="story-box failure-box" id="storyExplanation">
                <h4>ê·¸ë•Œ ë‚´ ìƒê°</h4>
                <p>ì°¨íŠ¸ì˜ ì ë“¤ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¤ë³´ë©´ ê° ì‹œì ì˜ ì œ ìƒê°ì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”!</p>
            </div>
            
            <div class="explanation">
                <h3>ì‹¤íŒ¨ì—ì„œ ë°°ìš´ í•µì‹¬ êµí›ˆ</h3>
                <ul>
                    <li>ì´ë™í‰ê· ì„ ì„ ë¬´ì‹œí•˜ê³  ê°ì •ì ìœ¼ë¡œ íˆ¬ìí–ˆë˜ ì‹¤ìˆ˜</li>
                    <li>ê±°ë˜ëŸ‰ ê¸‰ì¦ì„ ìœ„í—˜ ì‹ í˜¸ë¡œ ì¸ì‹í•˜ì§€ ëª»í–ˆë˜ ì </li>
                    <li>ì†ì ˆ ê¸°ì¤€ ì—†ì´ ë§‰ì—°í•œ ê¸°ëŒ€ì— ì˜ì¡´í–ˆë˜ ë¬¸ì œ</li>
                    <li>ì°¨íŠ¸ íŒ¨í„´ì„ ì²´ê³„ì ìœ¼ë¡œ ê³µë¶€í•œ í›„ì˜ ë³€í™”</li>
                </ul>
            </div>
        </div>

        <!-- ê¸°ë³¸ íŒ¨í„´ íƒ­ -->
        <div id="tab-basic" class="tab-content" style="display: none;">
            <div class="chart-area">
                <div class="chart-title">ê¸°ë³¸ ì°¨íŠ¸ íŒ¨í„´ - ì§€ì§€ì„ ê³¼ ì €í•­ì„ </div>
                
                <div class="pattern-selector">
                    <button class="pattern-btn active" onclick="showPattern('support')">ì§€ì§€ì„ </button>
                    <button class="pattern-btn" onclick="showPattern('resistance')">ì €í•­ì„ </button>
                    <button class="pattern-btn" onclick="showPattern('breakout')">ëŒíŒŒ</button>
                    <button class="pattern-btn" onclick="showPattern('triangle')">ì‚¼ê°í˜•</button>
                </div>
                
                <div class="chart-canvas-area">
                    <canvas id="basicChart"></canvas>
                </div>
                
                <div class="volume-area">
                    <canvas id="volumeChart"></canvas>
                </div>
            </div>
            
            <div class="explanation" id="patternExplanation">
                <h3>ì§€ì§€ì„  íŒ¨í„´ ë¶„ì„</h3>
                <ul>
                    <li>ì§€ì§€ì„ : ì£¼ê°€ê°€ ì—¬ëŸ¬ ë²ˆ ë°˜ë“±í•œ ê°€ê²©ëŒ€ (ë§¤ìˆ˜ ê´€ì‹¬ êµ¬ê°„)</li>
                    <li>ì§€ì§€ì„  ê·¼ì²˜ì—ì„œ ê±°ë˜ëŸ‰ ì¦ê°€ì™€ í•¨ê»˜ ë°˜ë“±í•˜ë©´ ê°•í•œ ë§¤ìˆ˜ ì‹ í˜¸</li>
                    <li>ì§€ì§€ì„  ì´íƒˆ ì‹œì—ëŠ” ì¶”ê°€ í•˜ë½ ê°€ëŠ¥ì„±ì´ ë†’ìŒ</li>
                    <li>ì§€ì§€ì„ ì€ í•œë²ˆ ê¹¨ì§€ë©´ ì €í•­ì„ ìœ¼ë¡œ ì—­í• ì´ ë°”ë€œ</li>
                </ul>
            </div>
        </div>

        <!-- ê³ ê¸‰ íŒ¨í„´ íƒ­ -->
        <div id="tab-advanced" class="tab-content" style="display: none;">
            <div class="chart-area">
                <div class="chart-title">ê³ ê¸‰ íŒ¨í„´ - ë¨¸ë¦¬ì–´ê¹¨í˜•ê³¼ ì´ì¤‘ë°”ë‹¥</div>
                
                <div class="pattern-selector">
                    <button class="pattern-btn active" onclick="showAdvancedPattern('headShoulders')">ë¨¸ë¦¬ì–´ê¹¨í˜•</button>
                    <button class="pattern-btn" onclick="showAdvancedPattern('doubleBottom')">ì´ì¤‘ë°”ë‹¥</button>
                    <button class="pattern-btn" onclick="showAdvancedPattern('cup')">ì»µì•¤í•¸ë“¤</button>
                    <button class="pattern-btn" onclick="showAdvancedPattern('flag')">ê¹ƒë°œí˜•</button>
                </div>
                
                <div class="chart-canvas-area">
                    <canvas id="advancedChart"></canvas>
                </div>
            </div>
            
            <div class="explanation" id="advancedExplanation">
                <h3>ë¨¸ë¦¬ì–´ê¹¨í˜• íŒ¨í„´</h3>
                <ul>
                    <li>ìƒìŠ¹ ì¶”ì„¸ì˜ ë§ˆì§€ë§‰ì— ë‚˜íƒ€ë‚˜ëŠ” ë°˜ì „ ì‹ í˜¸</li>
                    <li>ì™¼ìª½ ì–´ê¹¨ â†’ ë¨¸ë¦¬ â†’ ì˜¤ë¥¸ìª½ ì–´ê¹¨ ìˆœìœ¼ë¡œ í˜•ì„±</li>
                    <li>ë„¥ë¼ì¸ ì´íƒˆ ì‹œ ê°•í•œ í•˜ë½ ì‹ í˜¸</li>
                    <li>ê±°ë˜ëŸ‰ì€ ë¨¸ë¦¬ ë¶€ë¶„ì—ì„œ ê°ì†Œí•˜ëŠ” ê²ƒì´ íŠ¹ì§•</li>
                </ul>
            </div>
        </div>

        <!-- ì‹¤ì „ ì—°ìŠµ íƒ­ -->
        <div id="tab-practice" class="tab-content" style="display: none;">
            <div class="chart-area">
                <div class="chart-title">ì‹¤ì „ ì—°ìŠµ - íŒ¨í„´ì„ ì°¾ì•„ë³´ì„¸ìš”!</div>
                
                <div style="text-align: center; margin-bottom: 15px;">
                    <button class="btn btn-primary" onclick="generateRandomChart()">
                        ìƒˆë¡œìš´ ì°¨íŠ¸ ìƒì„±
                    </button>
                    <button class="btn btn-secondary" onclick="revealAnswer()">
                        ì •ë‹µ í™•ì¸
                    </button>
                </div>
                
                <div class="chart-canvas-area">
                    <canvas id="practiceChart"></canvas>
                </div>
                
                <div class="signal-indicator" id="practiceSignals" style="display: none;">
                    <div class="signal-item signal-buy" id="buySignal">ë§¤ìˆ˜ êµ¬ê°„</div>
                    <div class="signal-item signal-sell" id="sellSignal">ë§¤ë„ êµ¬ê°„</div>
                </div>
            </div>
            
            <div class="explanation" id="practiceExplanation">
                <h3>ì—°ìŠµ ë¬¸ì œ</h3>
                <p>ìœ„ ì°¨íŠ¸ì—ì„œ ë§¤ìˆ˜ì™€ ë§¤ë„ íƒ€ì´ë°ì„ ì°¾ì•„ë³´ì„¸ìš”. ì´ë™í‰ê· ì„ , ê±°ë˜ëŸ‰, ì§€ì§€/ì €í•­ì„ ì„ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í•´ë³´ì„¸ìš”!</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // ìŠ¤í† ë¦¬ ë°ì´í„°
        const storyData = {
            failure: {
                labels: ['ë§¤ìˆ˜ ì‹œì ', '1ì£¼ í›„', '2ì£¼ í›„', 'ì†ì ˆë§¤'],
                price: [68000, 66500, 64000, 61500],
                volume: [15000000, 18000000, 22000000, 25000000],
                ma20: [69500, 69000, 68200, 67000],
                stories: [
                    "ê¹€ê³¼ì¥ë‹˜ì´ ì‚¼ì„±ì „ì ì¢‹ë‹¤ê³  í•´ì„œ 68,000ì›ì— ë§¤ìˆ˜. ì´ë™í‰ê· ì„ ì´ ë­”ì§€ë„ ëª°ëì–´ìš”.",
                    "ì–´? ì¢€ ë–¨ì–´ì¡Œë„¤... ê·¸ë˜ë„ ì‚¼ì„±ì „ìì¸ë° ê´œì°®ê² ì§€? ë¼ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.",
                    "ê³„ì† ë–¨ì–´ì§€ëŠ”ë°... ë‰´ìŠ¤ë¥¼ ì°¾ì•„ë´ë„ íŠ¹ë³„í•œ ì•…ì¬ëŠ” ì—†ì—ˆì–´ìš”.",
                    "ë” ì´ìƒ ëª» ê²¬ë””ê² ì–´ì„œ 61,500ì›ì— ì†ì ˆë§¤. 10ë§Œì› ì†ì‹¤"
                ]
            },
            success: {
                labels: ['ê´€ë§', 'ì‹ í˜¸ í¬ì°©', 'ë§¤ìˆ˜', 'ìµì ˆ'],
                price: [62000, 63800, 65500, 69500],
                volume: [14000000, 16000000, 24000000, 32000000],
                ma20: [63500, 63200, 63800, 66100],
                stories: [
                    "ì´ë²ˆì—” ì´ë™í‰ê· ì„ ì„ í™•ì¸í•˜ê³  ì‹ ì¤‘í•˜ê²Œ ê´€ë§í–ˆì–´ìš”.",
                    "5ì¼ì„  ìœ„ë¡œ ì˜¬ë¼ì˜¤ê³  ê±°ë˜ëŸ‰ë„ ëŠ˜ì–´ë‚˜ë„¤! ì¢‹ì€ ì‹ í˜¸ì˜ˆìš”.",
                    "í™•ì‹ ì„ ê°€ì§€ê³  65,500ì›ì— ë§¤ìˆ˜! ì´ë²ˆì—” ê·¼ê±°ê°€ ìˆìŠµë‹ˆë‹¤.",
                    "ëª©í‘œê°€ ë„ë‹¬í•´ì„œ 69,500ì›ì— ìµì ˆ. 8ë§Œì› ìˆ˜ìµ!"
                ]
            }
        };

        // íŒ¨í„´ ë°ì´í„°
        const patternData = {
            support: {
                price: [60000, 62000, 61000, 60500, 63000, 62500, 64000, 66000],
                lines: { support: 60000 },
                explanation: {
                    title: "ì§€ì§€ì„  íŒ¨í„´ ë¶„ì„",
                    points: [
                        "ì§€ì§€ì„ : ì£¼ê°€ê°€ ì—¬ëŸ¬ ë²ˆ ë°˜ë“±í•œ ê°€ê²©ëŒ€ (ë§¤ìˆ˜ ê´€ì‹¬ êµ¬ê°„)",
                        "ì§€ì§€ì„  ê·¼ì²˜ì—ì„œ ê±°ë˜ëŸ‰ ì¦ê°€ì™€ í•¨ê»˜ ë°˜ë“±í•˜ë©´ ê°•í•œ ë§¤ìˆ˜ ì‹ í˜¸",
                        "ì§€ì§€ì„  ì´íƒˆ ì‹œì—ëŠ” ì¶”ê°€ í•˜ë½ ê°€ëŠ¥ì„±ì´ ë†’ìŒ",
                        "ì§€ì§€ì„ ì€ í•œë²ˆ ê¹¨ì§€ë©´ ì €í•­ì„ ìœ¼ë¡œ ì—­í• ì´ ë°”ë€œ"
                    ]
                }
            },
            resistance: {
                price: [58000, 60000, 62000, 64000, 63500, 64200, 63800, 62000],
                lines: { resistance: 64000 },
                explanation: {
                    title: "ì €í•­ì„  íŒ¨í„´ ë¶„ì„", 
                    points: [
                        "ì €í•­ì„ : ì£¼ê°€ê°€ ì—¬ëŸ¬ ë²ˆ í•˜ë½í•œ ê°€ê²©ëŒ€ (ë§¤ë„ ê´€ì‹¬ êµ¬ê°„)",
                        "ì €í•­ì„  ê·¼ì²˜ì—ì„œëŠ” ë§¤ë„ ì••ë ¥ì´ ê°•í•´ì ¸ ìƒìŠ¹ì´ ì œí•œë¨",
                        "ì €í•­ì„  ëŒíŒŒ ì‹œ ëŒ€ëŸ‰ ê±°ë˜ëŸ‰ê³¼ í•¨ê»˜ë¼ë©´ ê°•í•œ ìƒìŠ¹ ì‹ í˜¸",
                        "ëŒíŒŒëœ ì €í•­ì„ ì€ ì´í›„ ì§€ì§€ì„  ì—­í• ì„ í•˜ê²Œ ë¨"
                    ]
                }
            },
            breakout: {
                price: [61000, 61500, 62000, 61800, 62200, 63500, 65000, 67000],
                lines: { resistance: 62500 },
                explanation: {
                    title: "ëŒíŒŒ íŒ¨í„´ ë¶„ì„",
                    points: [
                        "ì €í•­ì„ ì„ í˜ìˆê²Œ ëŒíŒŒí•˜ë©´ì„œ ìƒìŠ¹í•˜ëŠ” íŒ¨í„´",
                        "ëŒíŒŒ ì‹œì ì— ê±°ë˜ëŸ‰ì´ í¬ê²Œ ì¦ê°€í•˜ëŠ” ê²ƒì´ í•µì‹¬",
                        "ëŒíŒŒ í›„ ë‹¤ì‹œ ì €í•­ì„ (í˜„ì¬ëŠ” ì§€ì§€ì„ ) ìœ„ì—ì„œ ì§€ì§€ë°›ìœ¼ë©´ í™•ì‹¤í•œ ì‹ í˜¸",
                        "ê°€ì§œ ëŒíŒŒë¥¼ ì£¼ì˜í•´ì•¼ í•¨ - ê±°ë˜ëŸ‰ ì—†ëŠ” ëŒíŒŒëŠ” ìœ„í—˜"
                    ]
                }
            },
            triangle: {
                price: [60000, 61000, 60500, 61200, 60800, 61100, 60900, 62500],
                lines: { support: [60000, 60900], resistance: [61000, 61100] },
                explanation: {
                    title: "ì‚¼ê°í˜• íŒ¨í„´ ë¶„ì„",
                    points: [
                        "ìƒìŠ¹í•˜ëŠ” ì§€ì§€ì„ ê³¼ í•˜ë½í•˜ëŠ” ì €í•­ì„ ì´ ë§Œë‚˜ëŠ” íŒ¨í„´",
                        "ë³€ë™í­ì´ ì ì°¨ ì¤„ì–´ë“¤ë©´ì„œ ì‚¼ê°í˜• ëª¨ì–‘ì„ í˜•ì„±",
                        "ë ë¶€ë¶„ì—ì„œ ì–´ëŠ ë°©í–¥ìœ¼ë¡œë“  í¬ê²Œ ì›€ì§ì¼ ê°€ëŠ¥ì„± ë†’ìŒ",
                        "ëŒíŒŒ ë°©í–¥ê³¼ ê±°ë˜ëŸ‰ì„ í™•ì¸í•˜ì—¬ ë§¤ë§¤ ë°©í–¥ ê²°ì •"
                    ]
                }
            }
        };

        // ê³ ê¸‰ íŒ¨í„´ ë°ì´í„°
        const advancedPatternData = {
            headShoulders: {
                price: [58000, 62000, 60000, 65000, 63000, 68000, 65000, 62000, 60000, 57000, 55000],
                volume: [20000000, 25000000, 22000000, 35000000, 30000000, 40000000, 28000000, 32000000, 38000000, 45000000, 50000000],
                points: {
                    leftShoulder: { index: 1, label: "ì™¼ìª½ ì–´ê¹¨" },
                    head: { index: 5, label: "ë¨¸ë¦¬" },
                    rightShoulder: { index: 7, label: "ì˜¤ë¥¸ìª½ ì–´ê¹¨" },
                    neckline: { price: 60000, label: "ë„¥ë¼ì¸" },
                    breakout: { index: 9, label: "ë„¥ë¼ì¸ ì´íƒˆ" }
                },
                explanation: {
                    title: "ë¨¸ë¦¬ì–´ê¹¨í˜• íŒ¨í„´",
                    points: [
                        "ìƒìŠ¹ ì¶”ì„¸ì˜ ë§ˆì§€ë§‰ì— ë‚˜íƒ€ë‚˜ëŠ” ê°•ë ¥í•œ í•˜ë½ ë°˜ì „ ì‹ í˜¸",
                        "ì™¼ìª½ ì–´ê¹¨ â†’ ë¨¸ë¦¬ â†’ ì˜¤ë¥¸ìª½ ì–´ê¹¨ ìˆœìœ¼ë¡œ í˜•ì„±ë˜ë©° ê° ê³ ì ì´ ë‚®ì•„ì§",
                        "ë„¥ë¼ì¸(ë‘ ì €ì ì„ ì—°ê²°í•œ ì„ ) ì´íƒˆ ì‹œ ê°•í•œ í•˜ë½ ì‹ í˜¸ í™•ì •",
                        "ê±°ë˜ëŸ‰ì€ ë¨¸ë¦¬ ë¶€ë¶„ì—ì„œ ê°ì†Œí•˜ê³  ë„¥ë¼ì¸ ì´íƒˆ ì‹œ ê¸‰ì¦í•˜ëŠ” ê²ƒì´ íŠ¹ì§•"
                    ]
                }
            },
            doubleBottom: {
                price: [65000, 60000, 58000, 62000, 64000, 61000, 58000, 61000, 65000, 68000, 72000],
                volume: [18000000, 25000000, 35000000, 22000000, 20000000, 28000000, 40000000, 30000000, 35000000, 45000000, 50000000],
                points: {
                    firstBottom: { index: 2, label: "ì²« ë²ˆì§¸ ë°”ë‹¥" },
                    peak: { index: 4, label: "ì¤‘ê°„ ê³ ì " },
                    secondBottom: { index: 6, label: "ë‘ ë²ˆì§¸ ë°”ë‹¥" },
                    neckline: { price: 64000, label: "ì €í•­ì„ " },
                    breakout: { index: 9, label: "ì €í•­ì„  ëŒíŒŒ" }
                },
                explanation: {
                    title: "ì´ì¤‘ë°”ë‹¥ íŒ¨í„´",
                    points: [
                        "í•˜ë½ ì¶”ì„¸ì˜ ë§ˆì§€ë§‰ì— ë‚˜íƒ€ë‚˜ëŠ” ê°•ë ¥í•œ ìƒìŠ¹ ë°˜ì „ ì‹ í˜¸",
                        "ë¹„ìŠ·í•œ ê°€ê²©ëŒ€ì—ì„œ ë‘ ë²ˆì˜ ì €ì ì„ í˜•ì„±í•˜ì—¬ Wì ëª¨ì–‘ ì™„ì„±",
                        "ë‘ ë²ˆì§¸ ë°”ë‹¥ì—ì„œëŠ” ì²« ë²ˆì§¸ë³´ë‹¤ ê±°ë˜ëŸ‰ì´ ì ì€ ê²ƒì´ ì¼ë°˜ì ",
                        "ì¤‘ê°„ ê³ ì ì„ ì—°ê²°í•œ ì €í•­ì„  ëŒíŒŒ ì‹œ ìƒìŠ¹ ì‹ í˜¸ í™•ì •"
                    ]
                }
            },
            cup: {
                price: [60000, 58000, 56000, 55000, 57000, 59000, 61000, 62000, 61000, 60000, 61500, 64000],
                volume: [25000000, 22000000, 20000000, 18000000, 20000000, 22000000, 25000000, 28000000, 20000000, 18000000, 35000000, 45000000],
                points: {
                    cupStart: { index: 0, label: "ì»µ ì‹œì‘" },
                    cupBottom: { index: 3, label: "ì»µ ë°”ë‹¥" },
                    cupEnd: { index: 7, label: "ì»µ ì™„ì„±" },
                    handleStart: { index: 7, label: "í•¸ë“¤ ì‹œì‘" },
                    handleEnd: { index: 9, label: "í•¸ë“¤ ë" },
                    breakout: { index: 11, label: "ëŒíŒŒ" }
                },
                explanation: {
                    title: "ì»µì•¤í•¸ë“¤ íŒ¨í„´",
                    points: [
                        "ìƒìŠ¹ ì¤‘ ì¼ì‹œ ì¡°ì • í›„ ì¬ìƒìŠ¹í•˜ëŠ” ì§€ì† íŒ¨í„´",
                        "ì»µ ëª¨ì–‘ì˜ ë‘¥ê·¼ ë°”ë‹¥ê³¼ ì‘ì€ í•¸ë“¤(ê¹ƒë°œ) í˜•íƒœë¡œ êµ¬ì„±",
                        "ì»µ í˜•ì„± ê¸°ê°„ì€ 7ì£¼~65ì£¼, í•¸ë“¤ì€ 1ì£¼~4ì£¼ê°€ ì¼ë°˜ì ",
                        "í•¸ë“¤ ëì—ì„œ ê±°ë˜ëŸ‰ ì¦ê°€ì™€ í•¨ê»˜ ëŒíŒŒ ì‹œ ê°•í•œ ìƒìŠ¹ ì‹ í˜¸"
                    ]
                }
            },
            flag: {
                price: [55000, 60000, 65000, 70000, 68000, 69000, 67000, 68000, 66000, 67000, 72000, 75000],
                volume: [30000000, 35000000, 40000000, 50000000, 25000000, 20000000, 18000000, 22000000, 20000000, 25000000, 45000000, 55000000],
                points: {
                    poleStart: { index: 0, label: "ê¹ƒëŒ€ ì‹œì‘" },
                    poleEnd: { index: 3, label: "ê¹ƒëŒ€ ë" },
                    flagStart: { index: 3, label: "ê¹ƒë°œ ì‹œì‘" },
                    flagEnd: { index: 9, label: "ê¹ƒë°œ ë" },
                    breakout: { index: 10, label: "ê¹ƒë°œ ëŒíŒŒ" }
                },
                explanation: {
                    title: "ê¹ƒë°œí˜• íŒ¨í„´",
                    points: [
                        "ê¸‰ê²©í•œ ìƒìŠ¹(ê¹ƒëŒ€) í›„ ì‘ì€ í•˜í–¥ ì¡°ì •(ê¹ƒë°œ)ì´ ë‚˜íƒ€ë‚˜ëŠ” ì§€ì† íŒ¨í„´",
                        "ê¹ƒë°œ êµ¬ê°„ì—ì„œëŠ” ê±°ë˜ëŸ‰ì´ í˜„ì €íˆ ê°ì†Œí•˜ëŠ” ê²ƒì´ íŠ¹ì§•",
                        "ê¹ƒë°œ ê¸°ê°„ì€ ë³´í†µ 1~3ì£¼ ì •ë„ë¡œ ì§§ì€ í¸",
                        "ê¹ƒë°œ ìƒë‹¨ ëŒíŒŒ ì‹œ ê¹ƒëŒ€ ê¸¸ì´ë§Œí¼ ì¶”ê°€ ìƒìŠ¹ ê¸°ëŒ€"
                    ]
                }
            }
        };

        let currentAdvancedPattern = 'headShoulders';

        // ê³µí†µ ì°¨íŠ¸ ì˜µì…˜
        function getCommonOptions() {
            return {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            usePointStyle: true,
                            padding: 15,
                            font: {
                                size: 11,
                                weight: 'bold'
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            font: {
                                size: 10
                            }
                        }
                    },
                    y: {
                        ticks: {
                            font: {
                                size: 10
                            },
                            callback: function(value) {
                                return value.toLocaleString() + 'ì›';
                            }
                        }
                    }
                }
            };
        }

        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ì„ íƒëœ íƒ­ ë³´ì´ê¸°
            document.getElementById('tab-' + tabName).style.display = 'block';
            event.target.classList.add('active');
            
            // íƒ­ ê·¸ë¦¬ê¸°
            setTimeout(() => {
                if (tabName === 'story') drawStoryChart();
                if (tabName === 'basic') drawBasicChart();
                if (tabName === 'advanced') {
                    drawAdvancedChart();
                    // ê³ ê¸‰ íŒ¨í„´ ì„¤ëª…ë„ ì—…ë°ì´íŠ¸
                    const explanation = advancedPatternData[currentAdvancedPattern].explanation;
                    document.getElementById('advancedExplanation').innerHTML = `
                        <h3>${explanation.title}</h3>
                        <ul>
                            ${explanation.points.map(point => `<li>${point}</li>`).join('')}
                        </ul>
                    `;
                }
                if (tabName === 'practice') drawPracticeChart();
            }, 100);
        }

        // ìŠ¤í† ë¦¬ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawStoryChart() {
            const ctx = document.getElementById('storyChart').getContext('2d');
            if (currentCharts.story) currentCharts.story.destroy();

            currentCharts.story = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['ì‹œì‘', '1ì£¼ì°¨', '2ì£¼ì°¨', '3ì£¼ì°¨'],
                    datasets: [{
                        label: 'ì‹¤íŒ¨í•œ íˆ¬ì',
                        data: storyData.failure.price,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.2)',
                        borderWidth: 2,
                        tension: 0.4,
                        pointBackgroundColor: '#ef4444',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }, {
                        label: 'ì„±ê³µí•œ íˆ¬ì',
                        data: storyData.success.price,
                        borderColor: '#22c55e',
                        backgroundColor: 'rgba(34, 197, 94, 0.2)',
                        borderWidth: 2,
                        tension: 0.4,
                        pointBackgroundColor: '#22c55e',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    ...getCommonOptions(),
                    onHover: (event, elements) => {
                        if (elements.length > 0) {
                            const datasetIndex = elements[0].datasetIndex;
                            const index = elements[0].index;
                            const story = datasetIndex === 0 ? 
                                storyData.failure.stories[index] : 
                                storyData.success.stories[index];
                            
                            const boxClass = datasetIndex === 0 ? 'failure-box' : 'success-box';
                            document.getElementById('storyExplanation').className = `story-box ${boxClass}`;
                            document.getElementById('storyExplanation').innerHTML = `
                                <h4>${datasetIndex === 0 ? 'ì‹¤íŒ¨' : 'ì„±ê³µ'} ì‹œì ì˜ ìƒê°</h4>
                                <p>${story}</p>
                            `;
                        }
                    }
                }
            });
        }

        // ê¸°ë³¸ íŒ¨í„´ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawBasicChart() {
            const data = patternData[currentPattern];
            const ctx = document.getElementById('basicChart').getContext('2d');
            if (currentCharts.basic) currentCharts.basic.destroy();

            const datasets = [{
                label: 'ì£¼ê°€',
                data: data.price,
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.2)',
                borderWidth: 2,
                tension: 0.4
            }];

            // ì§€ì§€ì„ /ì €í•­ì„  ì¶”ê°€
            if (data.lines.support) {
                datasets.push({
                    label: 'ì§€ì§€ì„ ',
                    data: new Array(data.price.length).fill(data.lines.support),
                    borderColor: '#22c55e',
                    borderDash: [8, 4],
                    borderWidth: 2,
                    fill: false,
                    pointRadius: 0
                });
            }

            if (data.lines.resistance) {
                datasets.push({
                    label: 'ì €í•­ì„ ',
                    data: new Array(data.price.length).fill(data.lines.resistance),
                    borderColor: '#ef4444',
                    borderDash: [8, 4],
                    borderWidth: 2,
                    fill: false,
                    pointRadius: 0
                });
            }

            currentCharts.basic = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1ì£¼', '2ì£¼', '3ì£¼', '4ì£¼', '5ì£¼', '6ì£¼', '7ì£¼', '8ì£¼'],
                    datasets: datasets
                },
                options: getCommonOptions()
            });

            // ê±°ë˜ëŸ‰ ì°¨íŠ¸
            const volumeCtx = document.getElementById('volumeChart').getContext('2d');
            if (currentCharts.volume) currentCharts.volume.destroy();

            currentCharts.volume = new Chart(volumeCtx, {
                type: 'bar',
                data: {
                    labels: ['1ì£¼', '2ì£¼', '3ì£¼', '4ì£¼', '5ì£¼', '6ì£¼', '7ì£¼', '8ì£¼'],
                    datasets: [{
                        label: 'ê±°ë˜ëŸ‰',
                        data: [15000000, 18000000, 22000000, 16000000, 20000000, 35000000, 28000000, 32000000],
                        backgroundColor: 'rgba(139, 92, 246, 0.8)',
                        borderColor: '#8b5cf6',
                        borderWidth: 1
                    }]
                },
                options: {
                    ...getCommonOptions(),
                    scales: {
                        ...getCommonOptions().scales,
                        y: {
                            ticks: {
                                font: {
                                    size: 10
                                },
                                callback: function(value) {
                                    return (value / 1000000).toFixed(0) + 'M';
                                }
                            }
                        }
                    }
                }
            });
        }

        // íŒ¨í„´ ì „í™˜
        function showPattern(patternName) {
            currentPattern = patternName;
            
            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.pattern-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            drawBasicChart();
            
            // ì„¤ëª… ì—…ë°ì´íŠ¸
            const explanation = patternData[patternName].explanation;
            document.getElementById('patternExplanation').innerHTML = `
                <h3>${explanation.title}</h3>
                <ul>
                    ${explanation.points.map(point => `<li>${point}</li>`).join('')}
                </ul>
            `;
        }

        // ê³ ê¸‰ íŒ¨í„´ ì°¨íŠ¸
        function drawAdvancedChart() {
            const data = advancedPatternData[currentAdvancedPattern];
            const ctx = document.getElementById('advancedChart').getContext('2d');
            if (currentCharts.advanced) currentCharts.advanced.destroy();

            // ê¸°ë³¸ ë°ì´í„°ì…‹
            const datasets = [{
                label: 'ì£¼ê°€',
                data: data.price,
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.2)',
                borderWidth: 2,
                tension: 0.4
            }];

            // íŒ¨í„´ë³„ íŠ¹ìˆ˜ ë¼ì¸ ì¶”ê°€
            if (currentAdvancedPattern === 'headShoulders' || currentAdvancedPattern === 'doubleBottom') {
                // ë„¥ë¼ì¸/ì €í•­ì„  ì¶”ê°€
                const linePrice = data.points.neckline.price;
                datasets.push({
                    label: data.points.neckline.label,
                    data: new Array(data.price.length).fill(linePrice),
                    borderColor: '#ef4444',
                    borderDash: [8, 4],
                    borderWidth: 2,
                    fill: false,
                    pointRadius: 0
                });
            }

            // íŒ¨í„´ë³„ íŠ¹ìˆ˜ í‘œì‹œ ì¶”ê°€
            if (currentAdvancedPattern === 'headShoulders') {
                // ë¨¸ë¦¬ì–´ê¹¨í˜• - ì–´ê¹¨ì™€ ë¨¸ë¦¬ ê°•ì¡°
                const shoulderHeadData = data.price.map((price, index) => {
                    if (index === data.points.leftShoulder.index || 
                        index === data.points.head.index || 
                        index === data.points.rightShoulder.index) {
                        return price;
                    }
                    return null;
                });
                
                datasets.push({
                    label: 'ì–´ê¹¨ì™€ ë¨¸ë¦¬',
                    data: shoulderHeadData,
                    borderColor: '#22c55e',
                    backgroundColor: '#22c55e',
                    borderWidth: 0,
                    pointRadius: 10,
                    pointHoverRadius: 12,
                    showLine: false,
                    pointStyle: 'triangle'
                });
            }
            
            if (currentAdvancedPattern === 'doubleBottom') {
                // ì´ì¤‘ë°”ë‹¥ - ë‘ ë°”ë‹¥ ê°•ì¡°
                const bottomData = data.price.map((price, index) => {
                    if (index === data.points.firstBottom.index || 
                        index === data.points.secondBottom.index) {
                        return price;
                    }
                    return null;
                });
                
                datasets.push({
                    label: 'ì´ì¤‘ ë°”ë‹¥',
                    data: bottomData,
                    borderColor: '#22c55e',
                    backgroundColor: '#22c55e',
                    borderWidth: 0,
                    pointRadius: 10,
                    pointHoverRadius: 12,
                    showLine: false,
                    pointStyle: 'rect'
                });
            }
            
            if (currentAdvancedPattern === 'cup') {
                // ì»µì•¤í•¸ë“¤ - í•¸ë“¤ êµ¬ê°„ ê°•ì¡°
                const handleData = data.price.map((price, index) => {
                    if (index >= data.points.handleStart.index && 
                        index <= data.points.handleEnd.index) {
                        return price;
                    }
                    return null;
                });
                
                datasets.push({
                    label: 'í•¸ë“¤ êµ¬ê°„',
                    data: handleData,
                    borderColor: '#8b5cf6',
                    backgroundColor: 'rgba(139, 92, 246, 0.3)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 0
                });
            }
            
            if (currentAdvancedPattern === 'flag') {
                // ê¹ƒë°œí˜• - ê¹ƒëŒ€ì™€ ê¹ƒë°œ êµ¬ë¶„
                const poleData = data.price.map((price, index) => {
                    if (index <= data.points.poleEnd.index) {
                        return price;
                    }
                    return null;
                });
                
                const flagData = data.price.map((price, index) => {
                    if (index >= data.points.flagStart.index && 
                        index <= data.points.flagEnd.index) {
                        return price;
                    }
                    return null;
                });
                
                datasets.push({
                    label: 'ê¹ƒëŒ€ (ê¸‰ìƒìŠ¹)',
                    data: poleData,
                    borderColor: '#22c55e',
                    backgroundColor: 'rgba(34, 197, 94, 0.3)',
                    borderWidth: 4,
                    tension: 0.4,
                    pointRadius: 0
                });
                
                datasets.push({
                    label: 'ê¹ƒë°œ (ì¡°ì •)',
                    data: flagData,
                    borderColor: '#f59e0b',
                    backgroundColor: 'rgba(245, 158, 11, 0.3)',
                    borderWidth: 3,
                    tension: 0.4,
                    pointRadius: 0
                });
            }

            // ê±°ë˜ëŸ‰ ì •ë³´ë¥¼ ìœ„í•œ ë¼ë²¨ ìƒì„±
            const labels = data.price.map((_, index) => `${index + 1}ì£¼`);

            currentCharts.advanced = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    ...getCommonOptions(),
                    plugins: {
                        ...getCommonOptions().plugins,
                        tooltip: {
                            ...getCommonOptions().plugins.tooltip,
                            callbacks: {
                                afterBody: function(context) {
                                    const index = context[0].dataIndex;
                                    const point = Object.values(data.points).find(p => p.index === index);
                                    if (point) {
                                        return [`ğŸ“ ${point.label}`];
                                    }
                                    
                                    // íŒ¨í„´ë³„ ì¶”ê°€ ì •ë³´
                                    if (currentAdvancedPattern === 'headShoulders' && index === data.points.breakout?.index) {
                                        return ['ğŸ’¥ ê°•í•œ í•˜ë½ ì‹ í˜¸!'];
                                    }
                                    if (currentAdvancedPattern === 'doubleBottom' && index === data.points.breakout?.index) {
                                        return ['ğŸš€ ê°•í•œ ìƒìŠ¹ ì‹ í˜¸!'];
                                    }
                                    if (currentAdvancedPattern === 'cup' && index === data.points.breakout?.index) {
                                        return ['ğŸ¯ ëª©í‘œê°€ ë‹¬ì„± ì˜ˆìƒ!'];
                                    }
                                    if (currentAdvancedPattern === 'flag' && index === data.points.breakout?.index) {
                                        return ['â¬†ï¸ ì¶”ê°€ ìƒìŠ¹ ê¸°ëŒ€!'];
                                    }
                                    
                                    return [];
                                }
                            }
                        }
                    }
                }
            });
        }

        // ì‹¤ì „ ì—°ìŠµ ì°¨íŠ¸
        function drawPracticeChart() {
            generateRandomChart();
        }

        function generateRandomChart() {
            // 40ì¼ì¹˜ ë°ì´í„° ìƒì„± (5ì¼ ì´í‰ì„ ì´ ë³´ì´ë„ë¡)
            practiceData = [];
            let price = 65000;
            
            for (let i = 0; i < 40; i++) {
                const change = (Math.random() - 0.5) * 0.06; // Â±3% ë³€ë™
                price = price * (1 + change);
                const volume = Math.floor(Math.random() * 30000000) + 15000000;
                
                practiceData.push({
                    date: `${i + 1}ì¼`,
                    price: Math.round(price),
                    volume: volume
                });
            }

            // 5ì¼ ì´ë™í‰ê· ì„  ê³„ì‚° (ë” ì§§ì€ ê¸°ê°„ìœ¼ë¡œ ë³€ê²½)
            const ma5Data = [];
            for (let i = 0; i < practiceData.length; i++) {
                if (i < 4) {
                    ma5Data.push(null);
                } else {
                    const sum = practiceData.slice(i - 4, i + 1).reduce((acc, item) => acc + item.price, 0);
                    ma5Data.push(Math.round(sum / 5));
                }
            }

            // ìµœê·¼ 20ì¼ë§Œ í‘œì‹œ (ì°¨íŠ¸ê°€ ë„ˆë¬´ ë³µì¡í•˜ì§€ ì•Šë„ë¡)
            const recentData = practiceData.slice(-20);
            const recentMA5 = ma5Data.slice(-20);

            const ctx = document.getElementById('practiceChart').getContext('2d');
            if (currentCharts.practice) currentCharts.practice.destroy();

            currentCharts.practice = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: recentData.map((d, index) => `${index + 21}ì¼`),
                    datasets: [{
                        label: 'ì£¼ê°€',
                        data: recentData.map(d => d.price),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderWidth: 2,
                        tension: 0.4
                    }, {
                        label: '5ì¼ ì´í‰ì„ ',
                        data: recentMA5,
                        borderColor: '#f59e0b',
                        borderDash: [4, 4],
                        borderWidth: 2,
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: getCommonOptions()
            });

            // ì •ë‹µ ìˆ¨ê¸°ê¸°
            document.getElementById('practiceSignals').style.display = 'none';
        }

        function revealAnswer() {
            if (!practiceData || practiceData.length === 0) {
                generateRandomChart();
                return;
            }

            // ìµœê·¼ 20ì¼ ë°ì´í„°ì™€ 5ì¼ ì´í‰ì„  ë‹¤ì‹œ ê³„ì‚°
            const recentData = practiceData.slice(-20);
            const ma5Data = [];
            
            for (let i = 0; i < practiceData.length; i++) {
                if (i < 4) {
                    ma5Data.push(null);
                } else {
                    const sum = practiceData.slice(i - 4, i + 1).reduce((acc, item) => acc + item.price, 0);
                    ma5Data.push(Math.round(sum / 5));
                }
            }
            const recentMA5 = ma5Data.slice(-20);

            // ë§¤ìˆ˜/ë§¤ë„ ì‹ í˜¸ ë¶„ì„
            let buySignals = [];
            let sellSignals = [];
            
            for (let i = 1; i < recentData.length; i++) {
                const prevPrice = recentData[i-1].price;
                const currentPrice = recentData[i].price;
                const currentMA5 = recentMA5[i];
                const prevMA5 = recentMA5[i-1];
                
                // ë§¤ìˆ˜ ì‹ í˜¸: ì£¼ê°€ê°€ 5ì¼ì„  ìœ„ë¡œ ì˜¬ë¼ê°€ëŠ” êµ¬ê°„
                if (prevPrice <= prevMA5 && currentPrice > currentMA5 && currentMA5) {
                    buySignals.push(i);
                }
                
                // ë§¤ë„ ì‹ í˜¸: ì£¼ê°€ê°€ 5ì¼ì„  ì•„ë˜ë¡œ ë–¨ì–´ì§€ëŠ” êµ¬ê°„  
                if (prevPrice >= prevMA5 && currentPrice < currentMA5 && currentMA5) {
                    sellSignals.push(i);
                }
            }

            // ê°€ê²© ê¸°ì¤€ ì§€ì§€/ì €í•­ ë¶„ì„
            const prices = recentData.map(d => d.price);
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            const supportLevel = minPrice + (maxPrice - minPrice) * 0.2; // í•˜ìœ„ 20% êµ¬ê°„
            const resistanceLevel = minPrice + (maxPrice - minPrice) * 0.8; // ìƒìœ„ 20% êµ¬ê°„

            // ì¶”ê°€ ë§¤ìˆ˜/ë§¤ë„ ì‹ í˜¸ (ì§€ì§€/ì €í•­ ê¸°ì¤€)
            for (let i = 0; i < recentData.length; i++) {
                const price = recentData[i].price;
                // ì§€ì§€ì„  ê·¼ì²˜ì—ì„œ ë°˜ë“±
                if (price <= supportLevel * 1.02 && price >= supportLevel * 0.98) {
                    if (!buySignals.includes(i)) buySignals.push(i);
                }
                // ì €í•­ì„  ê·¼ì²˜ì—ì„œ í•˜ë½
                if (price >= resistanceLevel * 0.98 && price <= resistanceLevel * 1.02) {
                    if (!sellSignals.includes(i)) sellSignals.push(i);
                }
            }

            // ê²°ê³¼ í‘œì‹œ
            document.getElementById('practiceSignals').style.display = 'flex';
            
            // êµ¬ì²´ì ì¸ ì‹ í˜¸ ì—…ë°ì´íŠ¸
            const buyDays = buySignals.map(i => `${i + 21}ì¼`).join(', ');
            const sellDays = sellSignals.map(i => `${i + 21}ì¼`).join(', ');
            
            document.getElementById('buySignal').textContent = 
                buySignals.length > 0 ? `ë§¤ìˆ˜: ${buyDays}` : 'ë§¤ìˆ˜ ì‹ í˜¸ ì—†ìŒ';
            document.getElementById('sellSignal').textContent = 
                sellSignals.length > 0 ? `ë§¤ë„: ${sellDays}` : 'ë§¤ë„ ì‹ í˜¸ ì—†ìŒ';

            // ë¶„ì„ ì„¤ëª… ì—…ë°ì´íŠ¸
            let analysisText = '<h3>ë¶„ì„ ê²°ê³¼</h3><ul>';
            
            if (buySignals.length > 0) {
                analysisText += `<li><strong>ë§¤ìˆ˜ ì‹ í˜¸:</strong> ${buyDays}ì—ì„œ ì£¼ê°€ê°€ 5ì¼ ì´í‰ì„ ì„ ìƒí–¥ ëŒíŒŒí•˜ê±°ë‚˜ ì§€ì§€ì„  ê·¼ì²˜ì—ì„œ ë°˜ë“±</li>`;
            }
            
            if (sellSignals.length > 0) {
                analysisText += `<li><strong>ë§¤ë„ ì‹ í˜¸:</strong> ${sellDays}ì—ì„œ ì£¼ê°€ê°€ 5ì¼ ì´í‰ì„ ì„ í•˜í–¥ ì´íƒˆí•˜ê±°ë‚˜ ì €í•­ì„  ê·¼ì²˜ì—ì„œ í•˜ë½</li>`;
            }
            
            analysisText += '<li><strong>ë¶„ì„ ê¸°ì¤€:</strong> 5ì¼ ì´ë™í‰ê· ì„  ëŒíŒŒ, ì§€ì§€/ì €í•­ì„  ê·¼ì²˜ ì›€ì§ì„</li>';
            analysisText += '<li><strong>ì£¼ì˜ì‚¬í•­:</strong> ê±°ë˜ëŸ‰ê³¼ í•¨ê»˜ í™•ì¸í•˜ì—¬ ì‹ í˜¸ì˜ ì‹ ë¢°ë„ë¥¼ ë†’ì´ì„¸ìš”</li>';
            analysisText += '</ul>';

            document.getElementById('practiceExplanation').innerHTML = analysisText;

            // ì°¨íŠ¸ì— ì‹ í˜¸ í‘œì‹œ (ì°¨íŠ¸ ì—…ë°ì´íŠ¸)
            updatePracticeChartWithSignals(buySignals, sellSignals, recentData, recentMA5);
        }

        function updatePracticeChartWithSignals(buySignals, sellSignals, recentData, recentMA5) {
            const ctx = document.getElementById('practiceChart').getContext('2d');
            if (currentCharts.practice) currentCharts.practice.destroy();

            // ë§¤ìˆ˜/ë§¤ë„ ì‹ í˜¸ í¬ì¸íŠ¸ ë°ì´í„° ìƒì„±
            const buyPoints = recentData.map((d, i) => buySignals.includes(i) ? d.price : null);
            const sellPoints = recentData.map((d, i) => sellSignals.includes(i) ? d.price : null);

            currentCharts.practice = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: recentData.map((d, index) => `${index + 21}ì¼`),
                    datasets: [{
                        label: 'ì£¼ê°€',
                        data: recentData.map(d => d.price),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderWidth: 2,
                        tension: 0.4
                    }, {
                        label: '5ì¼ ì´í‰ì„ ',
                        data: recentMA5,
                        borderColor: '#f59e0b',
                        borderDash: [4, 4],
                        borderWidth: 2,
                        fill: false,
                        pointRadius: 0
                    }, {
                        label: 'ë§¤ìˆ˜ ì‹ í˜¸',
                        data: buyPoints,
                        borderColor: '#22c55e',
                        backgroundColor: '#22c55e',
                        borderWidth: 0,
                        pointRadius: 8,
                        pointHoverRadius: 10,
                        showLine: false,
                        pointStyle: 'triangle'
                    }, {
                        label: 'ë§¤ë„ ì‹ í˜¸',
                        data: sellPoints,
                        borderColor: '#ef4444',
                        backgroundColor: '#ef4444',
                        borderWidth: 0,
                        pointRadius: 8,
                        pointHoverRadius: 10,
                        showLine: false,
                        pointStyle: 'rectRot'
                    }]
                },
                options: getCommonOptions()
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì²« ë²ˆì§¸ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        window.addEventListener('load', function() {
            drawStoryChart();
            
            // iframe ë†’ì´ ìë™ ì¡°ì ˆ í•¨ìˆ˜
            function adjustIframeHeight() {
                const contentHeight = document.body.scrollHeight;
                
                // ë¶€ëª¨ ì°½ì— ë†’ì´ ì •ë³´ ì „ë‹¬ (PostMessage API)
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'resize',
                        height: contentHeight
                    }, '*');
                }
            }
            
            // ì´ˆê¸° ë†’ì´ ì¡°ì ˆ
            setTimeout(adjustIframeHeight, 500);
            
            // íƒ­ ë³€ê²½ ì‹œ ë†’ì´ ì¬ì¡°ì ˆ
            const originalShowTab = window.showTab;
            window.showTab = function(tabName) {
                originalShowTab(tabName);
                setTimeout(adjustIframeHeight, 300);
            };
            
            // ì°½ í¬ê¸° ë³€ê²½ ì‹œ ë†’ì´ ì¬ì¡°ì ˆ
            window.addEventListener('resize', function() {
                setTimeout(adjustIframeHeight, 100);
            });
        });
    </script>
</body>
</html>